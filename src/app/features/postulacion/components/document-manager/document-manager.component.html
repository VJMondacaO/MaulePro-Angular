<div class="document-manager-container">
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold text-gray-800">Documentos Adjuntos</h3>
    <button
      pButton
      type="button"
      label="Agregar Documento"
      icon="pi pi-plus"
      (click)="abrirDialogNuevo()"
      class="p-button-primary"
    ></button>
  </div>

  <div *ngIf="documentos.length === 0" class="text-center py-8 text-gray-500">
    <i class="pi pi-file text-4xl mb-2"></i>
    <p>No hay documentos adjuntos</p>
  </div>

  <p-table
    *ngIf="documentos.length > 0"
    [value]="documentos"
    [paginator]="false"
    styleClass="p-datatable-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Nombre</th>
        <th>Archivo</th>
        <th>Tamaño</th>
        <th>Fecha</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-documento>
      <tr>
        <td>{{ documento.nombre }}</td>
        <td>{{ documento.nombreArchivo }}</td>
        <td>{{ formatearTamano(documento.archivo?.size || 0) }}</td>
        <td>{{ documento.fechaSubida | date:'short' }}</td>
        <td>
          <button
            pButton
            type="button"
            icon="pi pi-pencil"
            class="p-button-text p-button-sm"
            (click)="abrirDialogEditar(documento)"
            pTooltip="Editar"
          ></button>
          <button
            pButton
            type="button"
            icon="pi pi-trash"
            class="p-button-text p-button-sm p-button-danger"
            (click)="eliminarDocumento(documento)"
            pTooltip="Eliminar"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div *ngIf="documentos.length > 0" class="mt-4 text-sm text-gray-600">
    <p>Total: {{ documentos.length }} documento(s) - {{ getTamanioTotal() }}</p>
  </div>

  <!-- Dialog para agregar/editar documento -->
  <p-dialog
    [(visible)]="mostrarDialog"
    [header]="esEdicion() ? 'Editar Documento' : 'Agregar Documento'"
    [modal]="true"
    [style]="{width: '500px'}"
    (onHide)="cerrarDialog()"
  >
    <div class="space-y-4">
      <div *ngIf="error" class="p-3 bg-red-50 border border-red-200 rounded text-red-800 text-sm">
        {{ error }}
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          Nombre del Documento <span class="text-red-600">*</span>
        </label>
        <input
          type="text"
          [(ngModel)]="documentoSeleccionado!.nombre"
          placeholder="Ingrese el nombre del documento"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          Archivo <span class="text-red-600">*</span>
        </label>
        <input
          type="file"
          (change)="onFileSelect($event)"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg"
          accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"
        />
        <small class="text-gray-500 text-xs mt-1 block">
          Tamaño máximo: 4MB. Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, JPEG, PNG
        </small>
        <div *ngIf="archivoSeleccionado" class="mt-2 text-sm text-gray-600">
          <i class="pi pi-file"></i> {{ archivoSeleccionado.name }} 
          ({{ formatearTamano(archivoSeleccionado.size) }})
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <button
        pButton
        type="button"
        label="Cancelar"
        icon="pi pi-times"
        (click)="cerrarDialog()"
        class="p-button-text"
      ></button>
      <button
        pButton
        type="button"
        [label]="esEdicion() ? 'Actualizar' : 'Agregar'"
        icon="pi pi-check"
        (click)="guardarDocumento()"
        class="p-button-primary"
      ></button>
    </ng-template>
  </p-dialog>
</div>

